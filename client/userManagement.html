<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
        <script
            src="https://code.jquery.com/jquery-3.7.1.js"
            integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
            crossorigin="anonymous"
        ></script>
        <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
        <link rel="stylesheet" href="reset.css" />
        <style>
            #app {
                width: 800px;
                margin: 30px auto;
            }
            table,
            tr,
            th,
            td {
                border: 1px solid black;
                border-collapse: collapse;
                padding: 5px 10px;
                text-align: center;
            }
            th {
                width: 150px;
                background-color: beige;
            }
            td {
                width: 300px;
                text-align: left;
            }
            .check-btn {
                margin-left: 15px;
            }
            .header-wrap {
                background-color: antiquewhite;
            }
            header {
                max-width: 1140px;
                line-height: 50px;
                margin: 0 auto;
            }
            header nav ul {
                display: flex;
                justify-content: space-between;
                padding: 10px;
            }
            header nav ul li {
                padding: 10px;
            }
        </style>
    </head>
    <body>
        <div id="app">
            <!-- html 코드는 id가 app인 태그안에서 작업 -->
            <div class="header-wrap">
                <header>
                    <nav>
                        <ul>
                            <li>
                                <h1><a href="javascript:;">logo</a></h1>
                            </li>
                            <li>
                                <a href="reserve.html">예약하기</a>
                            </li>
                            <li>
                                <a href="checkReserve.html">예약확인</a>
                            </li>
                            <li>
                                <a href="main.html">HOME</a>
                            </li>
                            <li>
                                <a v-if="userAthority =='A'" href="userManagement.html">회원관리</a>
                                <a v-else href="myPage.html">마이페이지</a>
                            </li>
                            <li>
                                <a v-if="userAthority==''" href="login.html">로그인</a>
                                <a v-else href="javascript:;" @click="fnLogout">로그아웃</a>
                            </li>
                        </ul>
                    </nav>
                </header>
            </div>
            <div>
                <select v-model="pageSize" @change="fnList">
                    <option value="5">5개씩</option>
                    <option value="10">10개씩</option>
                    <option value="15">15개씩</option>
                    <option value="20">20개씩</option>
                </select>
                <table>
                    <tr>
                        <th>선택</th>
                        <th>이름</th>
                        <th>아이디</th>
                        <th>비밀번호</th>
                        <th>이메일</th>
                        <th>번호</th>
                        <th>생일</th>
                        <th>성별</th>
                        <th>가입날짜</th>
                    </tr>

                    <tr v-for="item in list">
                        <td><input type="checkbox" :value="item.USERID" v-model="selectItem" /></td>
                        <td>{{item.NAME}}</td>
                        <td>
                            <a href="javascript:;" @click="fnView(item.USERID , item.NAME)"> {{item.USERID}} </a>
                        </td>
                        <td>{{item.PASSWORD}}</td>
                        <td>{{item.EMAIL}}</td>
                        <td>{{item.PHONE}}</td>
                        <td>{{item.BIRTH}}</td>
                        <td>{{item.GENDER}}</td>
                        <td>{{item.CDATE}}</td>
                    </tr>
                </table>

                <div>
                    <button @click="fnUserRemove">삭제</button>
                </div>

                <a v-if="page != 1" href="javascript:;" @click="fnMove(-1)" class="index">◀</a>
                <a class="index" href="javascript:;" v-for="num in index" @click="fnPage(num)">
                    <span v-if="num == page" style="color: blue; font-weight: bold"> {{num}} </span>
                    <span v-else> {{num}} </span>
                </a>
                <a v-if="page != index" href="javascript:;" @click="fnMove(1)" class="index">▶</a>
            </div>
        </div>
    </body>
</html>

<script>
    const app = Vue.createApp({
        data() {
            return {
                // 변수 - (key : value)
                list: [],
                selectItem: [],
                userAthority: "",
                index: 0,
                pageSize: 5,
                page: 1,
            };
        },
        methods: {
            // 함수(메소드) - (key : function())
            fnList: function () {
                let self = this;
                let param = {pageSize : self.pageSize ,
                    offset: (self.page-1)*self.pageSize};
                $.ajax({
                    url: "http://localhost:3009/admin/userList",
                    dataType: "json",
                    type: "GET",
                    data: param,
                    success: function (data) {
                        console.log(data.list);
                        self.list = data.list;
                        self.index =  Math.ceil(data.count/self.pageSize);
                    },
                });
            },
            fnUserRemove() {
                let self = this;

                if (!confirm("정말삭제하시겠습니까?")) {
                    return;
                }

                console.log(self.selectItem.length);

                $.ajax({
                    url: "http://localhost:3009/user/delete",
                    dataType: "json",
                    type: "GET",
                    data: { removeList: self.selectItem },
                    traditional: true,
                    success: function (data) {
                        alert("삭제되었습니다");
                        self.fnList();
                    },
                });
            },
            fnView(userId, name) {
                location.href = `userManagement-view.html?userId=${userId}&NAME=${name}`;
            },
            fnLogout() {
                let self = this;
                sessionStorage.setItem("name", "");
                sessionStorage.setItem("athority", "");
                sessionStorage.setItem("userId", "");
                location.reload();
            },
            fnPage(num) {
                let self = this;
                self.page = num;
                self.fnList();
            },
            fnMove(num) {
                let self = this;
                self.page += num;
                self.fnList();
            },
        }, // methods
        mounted() {
            // 처음 시작할 때 실행되는 부분
            let self = this;
            self.userAthority = sessionStorage.getItem("athority");
            self.fnList();
        },
    });

    app.mount("#app");
</script>
