<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script
      src="https://code.jquery.com/jquery-3.7.1.js"
      integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
      crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="reset.css" />
    <style>
      /* 섹션 카드 느낌 */
      .section-wrap {
        background-color: white;
        padding: 30px 20px;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 600px;
        margin: 40px auto;
      }

      /* 테이블 디자인 */
      table {
        width: 100%;
        border-collapse: collapse;
      }

      th,
      td {
        text-align: left;
        padding: 12px 10px;
        border-bottom: 1px solid #ddd;
      }

      th {
        width: 120px;
        font-weight: 500;
        color: #333;
      }

      td input,
      td select {
        width: 100%;
        padding: 6px 10px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 0.95rem;
      }

      td input[type="radio"] {
        width: auto;
        margin-right: 5px;
      }
      .phone-cell select,
      .phone-cell input {
        width: 60px; /* 앞자리 select */
        margin-right: 5px;
        padding: 4px 6px;
        font-size: 0.9rem;
      }

      .phone-cell input:last-child {
        width: 70px; /* 마지막 4자리 */
      }

      /* 버튼 오른쪽 끝 정렬 */
      .btn-wrap {
        display: flex;
        justify-content: flex-end;
        margin-top: 20px;
      }

      .btn-wrap button {
        background-color: #4facfe;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 8px 16px;
        font-size: 0.95rem;
        cursor: pointer;
        transition: 0.3s;
      }

      .btn-wrap button:hover {
        opacity: 0.85;
      }
      .backbtn-wrap button {
        color: white;
        border: none;
        border-radius: 6px;
        padding: 8px 16px;
        cursor: pointer;
        margin-bottom: 10px;
        background-color: #f06b6b;
      }

      .backbtn-wrap button:hover {
        background-color: #ff4c4c;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <!-- html 코드는 id가 app인 태그안에서 작업 -->

      <div class="section-wrap">
        <div class="backbtn-wrap">
          <button @click="fnBack">나가기</button>
        </div>
        <table>
          <tr>
            <th>이름</th>
            <td>{{userInfo.NAME}}</td>
          </tr>
          <tr>
            <th>아이디</th>
            <td>{{userInfo.USERID}}</td>
          </tr>
          <tr>
            <th>비밀번호</th>
            <td><input type="text" v-model="userInfo.PASSWORD" /></td>
          </tr>
          <tr>
            <th>이메일</th>
            <td><input type="email" v-model="userInfo.EMAIL" /></td>
          </tr>
          <tr>
            <th>번호</th>
            <td class="phone-cell">
              <select v-model="phone1">
                <option value="010">010</option>
                <option value="011">011</option>
                <option value="012">012</option>
              </select>
              -
              <input type="text" v-model="phone2" placeholder="1234" maxlength="4" oninput="this.value =this.value.replace(/[^0-9.]/g, '')"/>
              -
              <input type="text" v-model="phone3" placeholder="5678" maxlength="4" oninput="this.value =this.value.replace(/[^0-9.]/g, '')"/>
            </td>
          </tr>
          <tr>
            <th>생일</th>
            <td><input type="date" v-model="userInfo.BIRTH" /></td>
          </tr>
          <tr>
            <th>성별</th>
            <td><input type="radio" value="M" v-model="userInfo.GENDER" />남자 <input type="radio" value="F" v-model="userInfo.GENDER" />여자</td>
          </tr>
          <tr>
            <th>가입날짜</th>
            <td>{{userInfo.CDATE}}</td>
          </tr>
        </table>
        <div class="btn-wrap">
          <button @click="fnmyPageEdit">수정완료</button>
        </div>
      </div>
    </div>
  </body>
</html>

<script>
  const app = Vue.createApp({
    data() {
      return {
        // 변수 - (key : value)
        userId: "",
        userInfo: {},
        phone1: "",
        phone2: "",
        phone3: "",
        regex: /^(?=.*[^\w\s])(?=\S{8}).+$/,
      };
    },
    methods: {
      // 함수(메소드) - (key : function())
      fnUserInfo: function () {
        let self = this;
        let param = { userId: self.userId };
        $.ajax({
          url: "http://localhost:3009/user/list",
          dataType: "json",
          type: "GET",
          data: param,
          success: function (data) {
            console.log(data.list[0].PHONE);
            self.userInfo = data.list[0];
            self.phone1 = data.list[0].PHONE.substr(0, 3);
            self.phone2 = data.list[0].PHONE.substr(4, 4);
            self.phone3 = data.list[0].PHONE.substr(9, 4);
          },
        });
      },
      fnmyPageEdit() {
        let self = this;
        let param = {
          userId: self.userId,
          password: self.userInfo.PASSWORD,
          email: self.userInfo.EMAIL,
          phone: `${self.phone1}-${self.phone2}-${self.phone3}`,
          birth: self.userInfo.BIRTH,
          gender: self.userInfo.GENDER,
        };

        if (self.userInfo.EMAIL == "") {
          alert("이메일을 입력해주세요.");
          return;
        }
        if (!self.regex.test(self.userInfo.PASSWORD)) {
          alert("비밀번호는 8자리 이상 , 특수문자 1개가 포함되어야합니다.");
          return;
        }

        if (self.userInfo.NAME == "") {
          alert("이름을 입력해주세요.");
          return;
        }
        if (self.userInfo.BIRTH == "") {
          alert("생년월일을 입력해주세요");
          return;
        }
        if (self.phone1 == "" || self.phone2.length < 3 || self.phone3.length < 4) {
          alert("번호를 다 입력해주세요");
          return;
        }
        $.ajax({
          url: "http://localhost:3009/user/edit",
          dataType: "json",
          type: "GET",
          data: param,
          success: function (data) {
            alert("수정완료");
            window.close();
            location.reload();
          },
        });
      },
      fnBack() {
        window.close();
      },
    }, // methods
    mounted() {
      // 처음 시작할 때 실행되는 부분
      let self = this;
      let queryParams = new URLSearchParams(window.location.search);
      self.userId = queryParams.get("userId") || "";
      self.fnUserInfo();
    },
  });

  app.mount("#app");
</script>
